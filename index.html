<!DOCTYPE html>
<html>
<head>
    <title>Watercolor Therapy Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #f4f1ea; cursor: crosshair; }
        #ui { position: fixed; top: 20px; left: 20px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 10; display: flex; flex-direction: column; gap: 10px; }
        .palette { display: grid; grid-template-columns: repeat(4, 30px); gap: 5px; }
        .color { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .active { border-color: #333; transform: scale(1.1); }
        /* Эффект бумаги через CSS фильтр */
        canvas { filter: contrast(1.1) brightness(1.05) url(#paper-texture); }
    </style>
</head>
<body>

<!-- SVG фильтр для имитации текстуры бумаги -->
<svg style="display:none;">
  <filter id="paper-texture">
    <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" result="noise" />
    <feDiffuseLighting in="noise" lighting-color="#f4f1ea" surfaceScale="2">
      <feDistantLight azimuth="45" elevation="60" />
    </feDiffuseLighting>
    <feComposite operator="in" in2="SourceGraphic" />
  </filter>
</svg>

<div id="ui">
    <div class="palette" id="palette">
        <div class="color active" style="background: #5d8aa8" data-color="#5d8aa8"></div>
        <div class="color" style="background: #e3a6a1" data-color="#e3a6a1"></div>
        <div class="color" style="background: #7da67d" data-color="#7da67d"></div>
        <div class="color" style="background: #d4a373" data-color="#d4a373"></div>
    </div>
    <input type="range" id="size" min="10" max="80" value="40">
    <button onclick="clearCanvas()">Очистить</button>
</div>

<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let color = "#5d8aa8";

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.fillStyle = '#f4f1ea';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function getRGB(hex) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `${r},${g},${b}`;
    }

    function draw(x, y) {
        const size = document.getElementById('size').value;
        const rgb = getRGB(color);
        
        // Магия акварели: рисуем много мелких пятен между текущей и прошлой точкой
        const dist = Math.hypot(x - lastX, y - lastY);
        const steps = dist / 2;

        for (let i = 0; i < steps; i++) {
            const lerpX = lastX + (x - lastX) * (i / steps);
            const lerpY = lastY + (y - lastY) * (i / steps);
            
            for (let j = 0; j < 3; j++) {
                ctx.beginPath();
                const rx = lerpX + (Math.random() - 0.5) * size;
                const ry = lerpY + (Math.random() - 0.5) * size;
                const radius = Math.random() * size * 0.8;
                
                ctx.arc(rx, ry, radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${rgb}, 0.015)`; // Очень низкая плотность
                ctx.fill();
            }
        }
        [lastX, lastY] = [x, y];
    }

    canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        [lastX, lastY] = [e.clientX, e.clientY];
    });

    window.addEventListener('mousemove', (e) => {
        if (isDrawing) draw(e.clientX, e.clientY);
    });

    window.addEventListener('mouseup', () => isDrawing = false);

    document.getElementById('palette').onclick = (e) => {
        if (e.target.classList.contains('color')) {
            document.querySelector('.active').classList.remove('active');
            e.target.classList.add('active');
            color = e.target.dataset.color;
        }
    };

    function clearCanvas() {
        ctx.clearRect(0,0, canvas.width, canvas.height);
        init();
    }

    init();
</script>
</body>
</html>
