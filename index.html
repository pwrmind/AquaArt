<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Watercolor Flow Therapy</title>
    <!-- Подключаем p5.js для работы с графикой и математикой -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/2.0.5/p5.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #fff; }
        #ui { 
            position: fixed; top: 20px; left: 20px; z-index: 100;
            display: flex; gap: 10px; background: white; padding: 10px;
            border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .dot { width: 25px; height: 25px; border-radius: 50%; cursor: pointer; border: 2px solid #eee; }
        .active { border-color: #333; transform: scale(1.1); }
    </style>
</head>
<body>

<div id="ui">
    <div id="palette" style="display: flex; gap: 8px;">
        <div class="dot active" style="background: #5d8aa8" data-clr="#5d8aa8"></div>
        <div class="dot" style="background: #e3a6a1" data-clr="#e3a6a1"></div>
        <div class="dot" style="background: #7da67d" data-clr="#7da67d"></div>
        <div class="dot" style="background: #f4d35e" data-clr="#f4d35e"></div>
    </div>
    <button onclick="clearCanvas()" style="border:none; background:none; cursor:pointer; color:#999;">Очистить</button>
</div>

<script>
let particles = [];
let selectedColor;

function setup() {
    createCanvas(windowWidth, windowHeight);
    background(255);
    selectedColor = color(93, 138, 168, 5); // Начальный цвет с очень низкой альфой
    noStroke();
    
    // Обработка палитры
    document.querySelectorAll('.dot').forEach(dot => {
        dot.onclick = (e) => {
            document.querySelector('.active').classList.remove('active');
            e.target.classList.add('active');
            let c = e.target.dataset.clr;
            selectedColor = color(c);
            selectedColor.setAlpha(5); // Ключ к акварели — прозрачность
        };
    });
}

function draw() {
    if (mouseIsPressed) {
        // При нажатии создаем "частицы пигмента"
        for (let i = 0; i < 5; i++) {
            particles.push(new Particle(mouseX, mouseY, selectedColor));
        }
    }

    // Обновляем и рисуем частицы (эффект диффузии)
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].show();
        if (particles[i].isFinished()) {
            particles.splice(i, 1);
        }
    }
}

class Particle {
    constructor(x, y, clr) {
        this.x = x;
        this.y = y;
        this.clr = clr;
        this.vel = p5.Vector.random2D().mult(random(0.5, 2)); // Скорость растекания
        this.alpha = 10;
        this.size = random(10, 30);
    }

    update() {
        this.x += this.vel.x;
        this.y += this.vel.y;
        this.vel.mult(0.96); // Затухание движения (вязкость воды)
        this.alpha -= 0.05;  // Постепенное "впитывание"
        this.size += 0.2;    // Расширение пятна при движении
    }

    show() {
        fill(red(this.clr), green(this.clr), blue(this.clr), this.alpha);
        ellipse(this.x, this.y, this.size);
    }

    isFinished() {
        return this.alpha <= 0;
    }
}

function clearCanvas() {
    background(255);
    particles = [];
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
    background(255);
}
</script>
</body>
</html>
